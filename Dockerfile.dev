# Use Node.js Alpine version
FROM node:22.14.0-alpine

# Install necessary packages
RUN apk update && apk add --no-cache yarn
RUN apk add --no-cache tzdata
ENV TZ=Asia/Jakarta
RUN cp /usr/share/zoneinfo/Asia/Jakarta /etc/localtime && echo "Asia/Jakarta" > /etc/timezone


# Set working directory inside the container
WORKDIR /usr/src/app

# Copy package files first for caching efficiency
COPY package.json .
# COPY yarn.lock .

# Copy application source code except node_modules
COPY . .

# Copy .env.example to .env inside the container
RUN cp .env.example .env

# Install dependencies, globally add nodemon, and clean yarn cache
RUN yarn install && yarn global add nodemon && yarn cache clean --all

# Entry point for development
CMD ["yarn", "dev"]
